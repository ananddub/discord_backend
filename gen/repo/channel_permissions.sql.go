// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: channel_permissions.sql

package repo

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const deleteChannelPermission = `-- name: DeleteChannelPermission :exec
DELETE FROM channel_permissions
WHERE id = $1
`

func (q *Queries) DeleteChannelPermission(ctx context.Context, id int32) error {
	_, err := q.db.Exec(ctx, deleteChannelPermission, id)
	return err
}

const deleteRoleChannelPermissions = `-- name: DeleteRoleChannelPermissions :exec
DELETE FROM channel_permissions
WHERE channel_id = $1 AND role_id = $2
`

type DeleteRoleChannelPermissionsParams struct {
	ChannelID int32       `json:"channel_id"`
	RoleID    pgtype.Int4 `json:"role_id"`
}

func (q *Queries) DeleteRoleChannelPermissions(ctx context.Context, arg DeleteRoleChannelPermissionsParams) error {
	_, err := q.db.Exec(ctx, deleteRoleChannelPermissions, arg.ChannelID, arg.RoleID)
	return err
}

const deleteUserChannelPermissions = `-- name: DeleteUserChannelPermissions :exec
DELETE FROM channel_permissions
WHERE channel_id = $1 AND user_id = $2
`

type DeleteUserChannelPermissionsParams struct {
	ChannelID int32       `json:"channel_id"`
	UserID    pgtype.Int4 `json:"user_id"`
}

func (q *Queries) DeleteUserChannelPermissions(ctx context.Context, arg DeleteUserChannelPermissionsParams) error {
	_, err := q.db.Exec(ctx, deleteUserChannelPermissions, arg.ChannelID, arg.UserID)
	return err
}

const getChannelPermissions = `-- name: GetChannelPermissions :many
SELECT id, channel_id, role_id, user_id, allow_permissions, deny_permissions, created_at FROM channel_permissions
WHERE channel_id = $1
`

func (q *Queries) GetChannelPermissions(ctx context.Context, channelID int32) ([]ChannelPermission, error) {
	rows, err := q.db.Query(ctx, getChannelPermissions, channelID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ChannelPermission
	for rows.Next() {
		var i ChannelPermission
		if err := rows.Scan(
			&i.ID,
			&i.ChannelID,
			&i.RoleID,
			&i.UserID,
			&i.AllowPermissions,
			&i.DenyPermissions,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getRoleChannelPermissions = `-- name: GetRoleChannelPermissions :one
SELECT id, channel_id, role_id, user_id, allow_permissions, deny_permissions, created_at FROM channel_permissions
WHERE channel_id = $1 AND role_id = $2 LIMIT 1
`

type GetRoleChannelPermissionsParams struct {
	ChannelID int32       `json:"channel_id"`
	RoleID    pgtype.Int4 `json:"role_id"`
}

func (q *Queries) GetRoleChannelPermissions(ctx context.Context, arg GetRoleChannelPermissionsParams) (ChannelPermission, error) {
	row := q.db.QueryRow(ctx, getRoleChannelPermissions, arg.ChannelID, arg.RoleID)
	var i ChannelPermission
	err := row.Scan(
		&i.ID,
		&i.ChannelID,
		&i.RoleID,
		&i.UserID,
		&i.AllowPermissions,
		&i.DenyPermissions,
		&i.CreatedAt,
	)
	return i, err
}

const getUserChannelPermissions = `-- name: GetUserChannelPermissions :one
SELECT id, channel_id, role_id, user_id, allow_permissions, deny_permissions, created_at FROM channel_permissions
WHERE channel_id = $1 AND user_id = $2 LIMIT 1
`

type GetUserChannelPermissionsParams struct {
	ChannelID int32       `json:"channel_id"`
	UserID    pgtype.Int4 `json:"user_id"`
}

func (q *Queries) GetUserChannelPermissions(ctx context.Context, arg GetUserChannelPermissionsParams) (ChannelPermission, error) {
	row := q.db.QueryRow(ctx, getUserChannelPermissions, arg.ChannelID, arg.UserID)
	var i ChannelPermission
	err := row.Scan(
		&i.ID,
		&i.ChannelID,
		&i.RoleID,
		&i.UserID,
		&i.AllowPermissions,
		&i.DenyPermissions,
		&i.CreatedAt,
	)
	return i, err
}

const setChannelPermission = `-- name: SetChannelPermission :one
INSERT INTO channel_permissions (
    channel_id, role_id, user_id, allow_permissions, deny_permissions
) VALUES (
    $1, $2, $3, $4, $5
)
ON CONFLICT (channel_id, role_id, user_id)
DO UPDATE SET
    allow_permissions = EXCLUDED.allow_permissions,
    deny_permissions = EXCLUDED.deny_permissions
RETURNING id, channel_id, role_id, user_id, allow_permissions, deny_permissions, created_at
`

type SetChannelPermissionParams struct {
	ChannelID        int32       `json:"channel_id"`
	RoleID           pgtype.Int4 `json:"role_id"`
	UserID           pgtype.Int4 `json:"user_id"`
	AllowPermissions pgtype.Int8 `json:"allow_permissions"`
	DenyPermissions  pgtype.Int8 `json:"deny_permissions"`
}

func (q *Queries) SetChannelPermission(ctx context.Context, arg SetChannelPermissionParams) (ChannelPermission, error) {
	row := q.db.QueryRow(ctx, setChannelPermission,
		arg.ChannelID,
		arg.RoleID,
		arg.UserID,
		arg.AllowPermissions,
		arg.DenyPermissions,
	)
	var i ChannelPermission
	err := row.Scan(
		&i.ID,
		&i.ChannelID,
		&i.RoleID,
		&i.UserID,
		&i.AllowPermissions,
		&i.DenyPermissions,
		&i.CreatedAt,
	)
	return i, err
}
