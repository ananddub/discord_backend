syntax = "proto3";

option go_package = "discord/pkg/proto";
import "schema/user.proto";

package protoservice.user;

service UserService {
  // User Management
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);
  rpc GetUserProfile(GetUserProfileRequest) returns (GetUserProfileResponse);
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);

  // User Status & Presence
  rpc UpdateStatus(UpdateStatusRequest) returns (UpdateStatusResponse);
  rpc GetUserPresence(GetUserPresenceRequest) returns (GetUserPresenceResponse);
  rpc SetCustomStatus(SetCustomStatusRequest) returns (SetCustomStatusResponse);

  // User Settings
  rpc UpdateUserSettings(UpdateUserSettingsRequest) returns (UpdateUserSettingsResponse);
  rpc GetUserSettings(GetUserSettingsRequest) returns (GetUserSettingsResponse);

  // User Relationships
  rpc BlockUser(BlockUserRequest) returns (BlockUserResponse);
  rpc UnblockUser(UnblockUserRequest) returns (UnblockUserResponse);
  rpc GetBlockedUsers(GetBlockedUsersRequest) returns (GetBlockedUsersResponse);

  // Streaming
  rpc StreamUserUpdates(StreamUserUpdatesRequest) returns (stream protoschema.User);
  rpc StreamUserFriendUpdates(StreamUserUpdatesRequest) returns (stream protoschema.User);

  rpc MinioGetUploadProfileUrl(MinioGetUploadProfileUrlRequest) returns (MinioGetUploadProfileUrlResponse);
}

message Empty { }

message MinioGetUploadProfileUrlRequest {
  int32 user_id = 1;
  string path = 2;
  string filename = 3;
  string filetype = 4;
}

message MinioGetUploadProfileUrlResponse {
  string upload_url = 1;
  string file_url = 2;
}

message GetUserRequest {
  int32 user_id = 1 ;
}

message GetUserResponse {
  protoschema.User user = 1;
  bool success = 2;
}

message UpdateUserRequest {
  protoschema.User user = 1 ;
}

message UpdateUserResponse {
  protoschema.User user = 1;
  bool success = 2;
}

message GetUserProfileRequest {
  int32 user_id = 1 ;
}

message GetUserProfileResponse {
  protoschema.User user = 1;
}

message DeleteUserRequest {
  int32 user_id = 1;
}

message DeleteUserResponse {
  bool success = 1;
}

// Status & Presence
message UpdateStatusRequest {
  int32 user_id = 1;
  string status = 2; // online, idle, dnd, offline, invisible
  string custom_status = 3;
  string activity = 4;
}

message UpdateStatusResponse {
  bool success = 1;
}

message GetUserPresenceRequest {
  int32 user_id = 1;
}

message GetUserPresenceResponse {
  string status = 1;
  string custom_status = 2;
  string activity = 3;
  int64 last_seen = 4;
}

message SetCustomStatusRequest {
  int32 user_id = 1;
  string custom_status = 2;
  string emoji = 3;
  int64 expires_at = 4; // 0 = never expires
}

message SetCustomStatusResponse {
  bool success = 1;
}

// User Settings
message UpdateUserSettingsRequest {
  int32 user_id = 1;
  bool show_current_activity = 2;
  bool allow_dms = 3;
  bool enable_notifications = 4;
  string theme = 5; // light, dark
  string language = 6;
}

message UpdateUserSettingsResponse {
  bool success = 1;
}

message GetUserSettingsRequest {
  int32 user_id = 1;
}

message GetUserSettingsResponse {
  bool show_current_activity = 1;
  bool allow_dms = 2;
  bool enable_notifications = 3;
  string theme = 4;
  string language = 5;
}

// User Blocking
message BlockUserRequest {
  int32 user_id = 1;
  int32 blocked_user_id = 2;
}

message BlockUserResponse {
  bool success = 1;
}

message UnblockUserRequest {
  int32 user_id = 1;
  int32 blocked_user_id = 2;
}

message UnblockUserResponse {
  bool success = 1;
}

message GetBlockedUsersRequest {
  int32 user_id = 1;
}

message GetBlockedUsersResponse {
  repeated int32 blocked_user_ids = 1;
}

message StreamUserUpdatesRequest {
  int32 user_id = 1;
}
