syntax = "proto3";

option go_package = "discord/gen/proto/service/dm";
import "schema/message.proto";
package protoservice.dm;

service DirectMessageService {
   // Message Operations
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);
  rpc GetMessages(GetMessagesRequest) returns (stream GetMessagesResponse);
  rpc GetMessage(GetMessageRequest) returns (GetMessageResponse);
  rpc EditMessage(EditMessageRequest) returns (EditMessageResponse);
  rpc DeleteMessage(DeleteMessageRequest) returns (DeleteMessageResponse);

  // Message Interactions
  rpc PinMessage(PinMessageRequest) returns (PinMessageResponse);
  rpc UnpinMessage(UnpinMessageRequest) returns (UnpinMessageResponse);
  rpc GetPinnedMessages(GetPinnedMessagesRequest) returns (GetPinnedMessagesResponse);
  rpc AddReaction(AddReactionRequest) returns (AddReactionResponse);
  rpc RemoveReaction(RemoveReactionRequest) returns (RemoveReactionResponse);
  rpc GetReactions(GetReactionsRequest) returns (GetReactionsResponse);

  // Typing Indicator
  rpc SendTyping(stream SendTypingRequest) returns (stream SendTypingResponse);

  // Bulk Operations
  rpc BulkDeleteMessages(BulkDeleteMessagesRequest) returns (BulkDeleteMessagesResponse);
  rpc SearchMessages(SearchMessagesRequest) returns (SearchMessagesResponse);
}

message SendMessageRequest {
  int32 receiver_id = 1 ;
  int32 sender_id = 2 ;
  string content = 3 ;
  optional int32 reply_to_message_id = 4;
}

message SendMessageResponse {
  protoschema.Message message = 1;
  bool success = 2;
}

message GetMessagesRequest {
  int32 user_id = 1;
  int32 sender_id = 2;
  int32 limit = 3;
  int32 offset = 4;
}

message GetMessagesResponse {
  repeated protoschema.Message messages = 1;
}

message EditMessageRequest {
  int32 message_id = 1;
  string content = 2;
}

message EditMessageResponse {
  protoschema.Message message = 1;
  bool success = 2;
}

message DeleteMessageRequest {
  int32 message_id = 1;
}

message DeleteMessageResponse {
  bool success = 1;
}

message GetMessageRequest {
  int32 message_id = 1;
}

message GetMessageResponse {
  int32 id = 1;
  int32 receiver_id = 2;
  int32 sender_id = 3;
  string content = 4;
  bool is_edited = 5;
  int64 created_at = 6;
}

// Pin Messages
message PinMessageRequest {
  int32 user_id = 1;
  int32 message_id = 2;
}

message PinMessageResponse {
  bool success = 1;
}

message UnpinMessageRequest {
  int32 user_id = 1;
  int32 message_id = 2;
}

message UnpinMessageResponse {
  bool success = 1;
}

message GetPinnedMessagesRequest {
  int32 user_id = 1;
}

message GetPinnedMessagesResponse {
  repeated int32 message_ids = 1;
}

// Reactions
message AddReactionRequest {
  int32 message_id = 1;
  int32 sender_id = 2;
  string emoji = 3;
}

message AddReactionResponse {
  bool success = 1;
}

message RemoveReactionRequest {
  int32 message_id = 1;
  int32 sender_id = 2;
  string emoji = 3;
}

message RemoveReactionResponse {
  bool success = 1;
}

message GetReactionsRequest {
  int32 message_id = 1;
  string emoji = 2; // Optional, get reactions for specific emoji
}

message GetReactionsResponse {
  repeated ReactionInfo reactions = 1;
}

message ReactionInfo {
  string emoji = 1;
  int32 count = 2;
  repeated int32 user_ids = 3;
}

// Typing Indicator
message SendTypingRequest {
  int32 sender_id = 1;
  bool is_typing = 2;
  int32 receiver_id = 3;
}

message SendTypingResponse {
  int32 sender_id = 1;
  bool is_typing = 2;
  int32 receiver_id = 3;

}

// Bulk Operations
message BulkDeleteMessagesRequest {
  int32 sender_id = 1;
  repeated int32 message_ids = 2;
}

message BulkDeleteMessagesResponse {
  int32 deleted_count = 1;
  bool success = 2;
}

message SearchMessagesRequest {
  int32 receiver_id = 1;
  int32 sender_id = 2; // Optional: search across server
  string query = 3;
  int32 limit = 4;
  int32 offset = 5;
}

message SearchMessagesResponse {
  repeated MessageSearchResult results = 1;
  int32 total_results = 2;
}

message MessageSearchResult {
  int32 message_id = 1;
  int32 receiver_id = 2;
  int32 sender_id = 3;
  string content = 4;
  int64 created_at = 5;
  string context_before = 6;
  string context_after = 7;
}
